<template>
    <div class="vueol-markerLayer">
        <slot/>
    </div>
</template>
<script>
    import layerMixins from "../../mixins/vectorLayer";

    export default {
        name: 'ol-markers',
        provide: function () {
            return {
                getLayer: this.getLayer
            }
        },
        inject: ['getMap'],
        mixins: [layerMixins],
        data() {
            return {
                layer: null
            }
        },
        beforeDestroy() {
            const vm = this;
            vm.getMap().then((mapObject) => {
                let source = vm.layer.getSource();
                source.getFeatures().forEach(function (f) {
                    let s = f.getStyle();
                    s = null;
                    f.setStyle(null);
                    f = null;
                })
                source.clear();
                mapObject.removeLayer(vm.layer);
            })
        },
        created() {
            const vm = this;
            vm.getMap().then((mapObject) => {
                vm.createLayer(mapObject, 'markers');
                vm.resolve(vm.layer);
            })
            vm.promise = new Promise(function (resolve) {
                vm.resolve = resolve;
            })
        },
        methods: {
            getLayer() {
                return this.promise;
            }
        }
    }
</script>
