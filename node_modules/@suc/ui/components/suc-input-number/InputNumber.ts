import { Component } from 'vue-property-decorator';
import { mixins } from 'vue-class-component';
import { InputNumber } from 'view-design';
import { ELEMENT_CLASS_PREFIX } from '../constants';

@Component
export default class SucInputNumber extends mixins(InputNumber) {
    wrapClass: string = `${ELEMENT_CLASS_PREFIX}input-number`;

    setValue(val: number) {
        // 如果 step 是小数，且没有设置 precision，是有问题的
        if (val && this.precision && !isNaN(this.precision)) val = Number(Number(val).toFixed(this.precision));
        const {min, max} = this;
        if (val !== null) {
            if (max && val > max) {
                val = max;
            } else if (min && val < min) {
                val = min;
            }
        }
        this.$nextTick(() => {
            //@ts-ignore
            this.currentValue = val;
            this.$emit('input', val);
            this.$emit('on-change', val);
            //@ts-ignore
            this.dispatch('FormItem', 'on-form-change', val);
        });
    }
}
